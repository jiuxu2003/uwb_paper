# Feature Specification: TH-UWB Communication System Simulation

**Feature Branch**: `001-th-uwb-simulation`
**Created**: 2025-12-17
**Status**: Draft
**Input**: User description: "我需要写一篇高水平的 UWB 课程论文，请帮我用 Python (或 MATLAB) 写一套完整的仿真代码。

**核心任务**：模拟一个 **TH-UWB（跳时-脉冲位置调制）** 通信系统，并重点分析它在\"由于用户增多导致的内部干扰\"和\"外部强窄带干扰\"下的性能表现。

**具体仿真步骤和需求如下：**

**1. 构建发射信号（源于课件第四章）**

- **信号格式**：采用 TH-PPM (跳时-脉冲位置调制) 格式。
- **参数设置**：请定义帧周期 ($T_f$)、时隙宽度 ($T_c$)。
- **脉冲波形**：使用**二阶高斯导数脉冲 (Gaussian Monocycle)**。
- **多用户机制**：给每一个用户分配一个独特的**随机跳时序列 (TH Code)**，模拟多用户同时发信的场景。

**2. 模拟恶劣信道（源于课件第三章）**

- **基础环境**：加入高斯白噪声 (AWGN)。
- **挑战一（多用户干扰 MUI）**：我想看到当用户数量增加时（比如从 1个增加到 5个、10个），系统性能是怎么下降的。
- **挑战二（窄带干扰 NBI）**：在信道中强行加入一个**单频正弦波**（模拟现实中的 GSM 或 WiFi 干扰信号），我要看看 UWB 对这种窄带干扰的抵抗能力。

**3. 接收与解调（源于课件第四章）**

- 使用**相关接收机 (Correlator Receiver)**。
- 假设接收端已经完美同步（知道了对方的跳时序列和时序）。

**4. 论文需要的图表（可视化）**

- **图1 - 信号时域图**：画出一段包含跳时特性的发射信号波形，让人一眼看懂 TH-PPM 是怎么工作的。
- **图2 - 抗多用户干扰性能**：固定信噪比（例如 SNR=10dB），横轴是**用户数量 (User Number)**，纵轴是**误码率 (BER)**。预期曲线是随着用户增加，误码率上升。
- **图3 - 抗窄带干扰性能**：固定只有一个用户，横轴是**信干比 (SIR)**（即信号功率与窄带干扰功率之比），纵轴是**误码率 (BER)**。我想看当干扰非常强时，UWB 是否还能勉强工作。

**要求**：

- 代码结构清晰，关键步骤（如调制、加噪、解调）要有注释。
- 生成的图表请加上网格、图例和轴标签，风格要严谨，适合直接截图放在论文里。"

## Clarifications

### Session 2025-12-17

- Q: 技术栈选择（Python 或 MATLAB）？ → A: Python
- Q: 窄带干扰频率设置？ → A: 2.4 GHz（WiFi 频段）
- Q: PPM 调制时延参数？ → A: δ = Tc/2（时隙宽度的一半，标准二进制 PPM）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基础 TH-UWB 信号生成与可视化 (Priority: P1)

作为论文作者，我需要生成标准的 TH-UWB 信号并查看其时域波形，以便在论文中展示跳时脉冲位置调制（TH-PPM）的工作原理。

**Why this priority**: 这是整个仿真系统的基础。没有正确的信号生成，后续的信道模拟和性能分析都无法进行。时域波形图是论文中最直观的示意图，读者通过它能快速理解 TH-PPM 的核心机制。

**Independent Test**: 可以通过运行信号生成模块并检查输出的时域图来独立测试。验证标准包括：脉冲波形符合二阶高斯导数特征、帧结构体现跳时序列、脉冲位置反映调制信息。

**Acceptance Scenarios**:

1. **Given** 系统配置了帧周期和时隙参数，**When** 生成单用户的 TH-PPM 信号，**Then** 输出的时域波形图清晰显示跳时特性和脉冲位置调制效果，包含合适的时间轴标注和图例
2. **Given** 系统设置了二阶高斯导数脉冲参数，**When** 生成信号波形，**Then** 单个脉冲的形状符合二阶高斯导数的数学特征（中心峰值为零，两侧对称的正负峰）
3. **Given** 为用户分配了唯一的跳时序列，**When** 生成多帧信号，**Then** 每帧的脉冲出现时刻严格遵循该跳时序列的时隙分配规则

---

### User Story 2 - 多用户干扰性能分析 (Priority: P2)

作为论文作者，我需要模拟多用户同时通信的场景，并分析用户数量增加对误码率的影响，以便在论文中量化评估 TH-UWB 系统的抗多用户干扰（MUI）能力。

**Why this priority**: 多用户干扰是 TH-UWB 系统的核心挑战之一，也是论文的重点分析内容。通过量化用户数量与误码率的关系，可以评估系统的容量上限和跳时码的有效性。

**Independent Test**: 可以通过固定信噪比（如 10dB），改变用户数量（1、2、5、10个），运行仿真并生成 BER vs 用户数量曲线来独立测试。验证标准：随着用户增加，BER 单调上升，曲线趋势符合理论预期。

**Acceptance Scenarios**:

1. **Given** 系统配置了 SNR=10dB 的噪声环境，**When** 仿真 1 个用户通信，**Then** 测得的误码率作为基准值，曲线图上该点标注清晰
2. **Given** 多个用户使用不同的随机跳时序列，**When** 用户数量从 1 增加到 10，**Then** 生成的性能曲线显示误码率随用户数量单调上升，图表包含网格、轴标签（"用户数量" vs "误码率 BER"）和图例
3. **Given** 固定的信号参数和信道条件，**When** 运行多次仿真（如 10000 个数据符号），**Then** 每个用户数量点的误码率估计具有统计稳定性（置信区间可接受）

---

### User Story 3 - 窄带干扰抑制性能分析 (Priority: P3)

作为论文作者，我需要在信道中加入强窄带干扰（单频正弦波），并分析信干比（SIR）对误码率的影响，以便在论文中展示 UWB 系统对外部窄带干扰（NBI）的鲁棒性。

**Why this priority**: 窄带干扰抑制是 UWB 技术相比传统窄带通信的独特优势。通过模拟 GSM 或 WiFi 等窄带干扰源，可以验证 UWB 的抗干扰能力，这是论文的另一个重要论证点。

**Independent Test**: 可以通过固定为单用户场景，在信道中叠加不同强度的单频正弦干扰，改变信干比（SIR），运行仿真并生成 BER vs SIR 曲线来独立测试。验证标准：当 SIR 降低（干扰增强）时，BER 上升，但即使在强干扰下系统仍能勉强工作。

**Acceptance Scenarios**:

1. **Given** 信道中无窄带干扰（SIR 无穷大），**When** 运行单用户仿真，**Then** 测得的误码率作为最优基准值
2. **Given** 信道中加入特定频率的单频正弦波干扰，**When** 改变干扰功率使 SIR 从高到低变化（如 30dB 到 -10dB），**Then** 生成的性能曲线显示误码率随 SIR 降低而上升，图表包含网格、轴标签（"信干比 SIR (dB)" vs "误码率 BER"）和图例
3. **Given** 极端的窄带干扰场景（如 SIR=-10dB，干扰功率远大于信号功率），**When** 运行仿真，**Then** 系统仍能解调出部分正确数据（BER < 0.5），证明 UWB 的抗干扰能力

---

### Edge Cases

- **超高用户数场景**：当用户数量超过 10 个时，系统性能是否完全崩溃（BER 接近 0.5）还是仍有一定的通信能力？
- **极低信噪比**：当 SNR 低于 0dB 时，即使没有多用户干扰，系统能否维持通信？
- **跳时序列冲突**：当多个用户的跳时序列偶然出现时隙重叠时，系统如何表现？
- **脉冲参数极端值**：帧周期或时隙宽度设置不合理时（如帧周期过短导致脉冲重叠），系统行为如何？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须生成符合 TH-PPM 调制格式的 UWB 信号，其中每个数据比特通过脉冲位置偏移进行编码（比特 0 在时隙起始位置，比特 1 偏移 δ = Tc/2）
- **FR-002**: 系统必须使用二阶高斯导数波形作为基础脉冲形状，脉冲参数（如脉冲宽度）可配置
- **FR-003**: 系统必须为每个用户分配唯一的随机跳时序列（TH Code），确保不同用户的脉冲在时隙上尽量分散
- **FR-004**: 系统必须支持配置通信系统参数，包括帧周期（Tf）、时隙宽度（Tc）、每帧时隙数量、脉冲时延等
- **FR-005**: 系统必须模拟 AWGN（高斯白噪声）信道，支持配置信噪比（SNR）
- **FR-006**: 系统必须支持多用户场景仿真，允许配置用户数量（1 到 20 个），每个用户独立发送数据
- **FR-007**: 系统必须支持叠加单频正弦波窄带干扰（频率设为 2.4 GHz，模拟 WiFi 干扰源），允许配置干扰功率（或信干比 SIR）
- **FR-008**: 系统必须实现相关接收机解调算法，假设接收端完美同步（已知跳时序列和精确时序）
- **FR-009**: 系统必须计算并输出误码率（BER），基于足够的仿真样本数（至少 1000 个数据符号）确保统计有效性
- **FR-010**: 系统必须生成时域信号波形图，清晰展示跳时特性和脉冲位置调制效果，图表包含时间轴、幅度轴、网格和标题
- **FR-011**: 系统必须生成误码率 vs 用户数量性能曲线，固定 SNR（如 10dB），横轴为用户数量，纵轴为 BER（对数坐标），包含网格、轴标签和图例
- **FR-012**: 系统必须生成误码率 vs 信干比性能曲线，固定单用户场景，横轴为 SIR（dB），纵轴为 BER（对数坐标），包含网格、轴标签和图例
- **FR-013**: 所有生成的图表必须采用适合学术论文的严谨风格，包括清晰的字体、合适的图例位置、专业的配色方案
- **FR-014**: 系统必须支持可重复仿真，允许设置随机数种子以确保结果可复现

### Key Entities

- **TH-UWB Signal（跳时超宽带信号）**: 由一系列具有跳时特性的脉冲组成的时域信号。关键属性包括帧周期、时隙宽度、跳时序列、脉冲波形类型、调制方式（PPM）。
- **User（用户）**: 通信系统中的发送实体。每个用户拥有唯一的跳时序列、独立的数据比特流、相同的脉冲波形参数。
- **Channel（信道）**: 信号传播环境的抽象。包含 AWGN 噪声（由 SNR 表征）、多用户干扰（来自其他用户的信号叠加）、窄带干扰（单频正弦波，由 SIR 表征）。
- **Receiver（接收机）**: 解调和检测模块。使用相关接收算法，基于已知的跳时序列和模板脉冲进行信号匹配，输出判决比特。
- **Performance Metric（性能指标）**: 系统性能的量化度量。主要指标为误码率（BER），即错误比特数与总比特数之比。
- **Visualization Output（可视化输出）**: 论文所需的图表。包括时域波形图、BER-用户数量曲线图、BER-SIR 曲线图，所有图表需符合学术出版规范。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 生成的时域波形图能够清晰展示至少 3 帧信号，每帧内脉冲位置与跳时序列和调制比特的对应关系清晰可辨，图表适合直接用于论文插图
- **SC-002**: 多用户干扰性能曲线准确反映理论趋势：在 SNR=10dB 条件下，当用户数量从 1 增加到 10 时，误码率从低于 10^-3 增长至接近 10^-1 量级（具体数值取决于跳时序列设计）
- **SC-003**: 窄带干扰性能曲线验证 UWB 抗干扰能力：当 SIR 从 30dB 降低到 0dB 时，误码率上升不超过 2 个数量级；即使在 SIR=-10dB 的极端干扰下，误码率仍低于 0.4（优于随机猜测）
- **SC-004**: 所有仿真结果具有统计稳定性：每个性能点基于至少 10^4 个发送比特，确保误码率估计的相对误差小于 20%
- **SC-005**: 生成的三张图表（时域图、BER-用户数图、BER-SIR 图）均包含完整的图表元素（标题、轴标签、网格、图例、单位标注），图像分辨率适合论文打印（至少 300 DPI 等效）
- **SC-006**: 仿真系统能够在合理时间内完成所有分析：单次性能点仿真（10^4 比特）耗时不超过 1 分钟，完整生成一条性能曲线（10 个性能点）耗时不超过 15 分钟
- **SC-007**: 代码具有良好的可读性和可维护性：关键模块（信号生成、信道模拟、接收解调、性能分析）功能边界清晰，核心算法步骤有中文注释说明物理意义
- **SC-008**: 仿真结果可重复：使用相同的参数和随机数种子运行仿真，能得到完全一致的性能曲线和图表输出
