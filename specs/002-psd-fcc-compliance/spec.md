# Feature Specification: UWB 脉冲功率谱密度与 FCC 合规性分析可视化

**Feature Branch**: `002-psd-fcc-compliance`
**Created**: 2025-12-17
**Status**: Draft
**Input**: User description: "为了完善论文，我还需要最后一张核心图表，请帮我生成绘制代码。需求：UWB 脉冲功率谱密度 (PSD) 与 FCC 室内掩蔽罩 (Indoor Mask) 的对比图。具体要求：参考标准：根据 FCC 标准，画出室内辐射掩蔽罩（关键点：0.96-1.61GHz 为 -75.3dBm, 3.1-10.6GHz 为 -41.3dBm 等）；脉冲波形：计算并画出 2阶 和 5阶 高斯导数脉冲的 PSD；合规性分析：将脉冲 PSD 与 FCC Mask 画在同一张图上；调整脉冲中心频率参数，使得 5阶脉冲能量主要集中在 3.1-10.6 GHz 合法范围内；展示出 2阶脉冲可能因为频谱太靠左（低频）而不合规；绘图细节：横轴为频率 (0-12 GHz)，纵轴为 PSD (dBm/MHz)，加图例、网格和清晰标注。"

## User Scenarios & Testing

### User Story 1 - 验证脉冲设计的 FCC 合规性 (Priority: P1)

作为 UWB 系统研究人员，我需要验证当前设计的脉冲是否符合 FCC Part 15.209 室内辐射限制标准，以确保系统设计的合法性和可行性。

**Why this priority**: 这是论文的核心技术验证，FCC 合规性直接决定 UWB 系统能否实际部署。没有合规性验证，整个系统设计将无法被学术界和工业界接受。

**Independent Test**: 可以通过提供标准的 2 阶和 5 阶高斯导数脉冲参数，生成包含 FCC 掩蔽罩和脉冲 PSD 的对比图表，并自动判断合规性状态。这个功能可以独立运行并立即展示价值。

**Acceptance Scenarios**:

1. **Given** 系统提供了 2 阶高斯导数脉冲参数（τ=0.5ns），**When** 研究人员生成 PSD 对比图，**Then** 图表清晰显示该脉冲在低频段（<3.1 GHz）超出 FCC 限制，标注为"不合规"
2. **Given** 系统提供了 5 阶高斯导数脉冲参数（中心频率 6.85 GHz），**When** 研究人员生成 PSD 对比图，**Then** 图表显示该脉冲主要能量集中在 3.1-10.6 GHz 范围内，所有频点均低于 FCC 限制线，标注为"合规"
3. **Given** FCC 掩蔽罩包含多个关键频段限制，**When** 图表生成完成，**Then** 所有关键频段（0.96-1.61 GHz: -75.3 dBm, 1.61-3.1 GHz: -53.3 dBm, 3.1-10.6 GHz: -41.3 dBm, >10.6 GHz: -51.3 dBm）均清晰标注在图表上

---

### User Story 2 - 比较不同阶数脉冲的频谱特性 (Priority: P2)

作为 UWB 系统研究人员，我需要在同一张图上对比 2 阶和 5 阶高斯导数脉冲的频谱分布，以理解脉冲阶数对频谱特性的影响，为脉冲设计提供依据。

**Why this priority**: 这是论文的技术对比分析部分，帮助读者理解不同脉冲设计选择的优劣。虽然重要，但建立在 P1（合规性验证）的基础之上。

**Independent Test**: 可以通过调用脉冲生成模块生成 2 阶和 5 阶脉冲，计算它们的 PSD，并在同一图表上用不同颜色/线型展示。即使没有 FCC 掩蔽罩，这个对比分析也能独立交付价值。

**Acceptance Scenarios**:

1. **Given** 系统同时生成 2 阶和 5 阶脉冲，**When** 计算它们的 PSD，**Then** 图表用不同颜色（例如蓝色和绿色）和不同线型（实线和虚线）区分显示两条曲线
2. **Given** 2 阶脉冲的频谱中心频率较低，5 阶脉冲的频谱中心频率较高，**When** 查看图表，**Then** 可以清楚观察到 5 阶脉冲的能量分布向高频偏移，峰值频率约为 2 阶脉冲的 2.5 倍
3. **Given** 图表包含图例，**When** 查看图例，**Then** 图例清楚标注了"2 阶高斯导数脉冲"和"5 阶高斯导数脉冲"，并正确对应各自的颜色和线型

---

### User Story 3 - 优化脉冲参数以满足 FCC 规范 (Priority: P3)

作为 UWB 系统研究人员，我需要调整脉冲的中心频率参数，观察 PSD 曲线的变化，找到满足 FCC 规范的最优参数组合。

**Why this priority**: 这是参数优化功能，属于高级应用场景。在确保基本合规性验证（P1）和对比分析（P2）功能完整后，这个功能可以进一步提升系统的实用价值。

**Independent Test**: 可以通过提供脉冲参数调整接口，允许用户修改中心频率、脉冲宽度等参数，实时重新生成图表，观察 PSD 曲线与 FCC 掩蔽罩的相对位置变化。这个功能可以作为独立的参数调优工具交付。

**Acceptance Scenarios**:

1. **Given** 用户希望调整 5 阶脉冲的中心频率，**When** 用户修改中心频率参数从 5 GHz 增加到 8 GHz，**Then** 图表实时更新，显示 PSD 曲线整体向高频偏移，更多能量集中在 3.1-10.6 GHz 合法频段内
2. **Given** 用户调整脉冲宽度参数 τ，**When** τ 从 0.3ns 增加到 0.7ns，**Then** PSD 曲线的峰值降低，频谱展宽，系统自动重新评估合规性状态
3. **Given** 用户找到了满足 FCC 规范的参数组合，**When** 导出图表，**Then** 图表中包含当前使用的参数值标注（例如"5 阶脉冲，fc=6.85 GHz，τ=0.5ns"）

---

### Edge Cases

- **What happens when** 脉冲 PSD 在某些频段刚好等于 FCC 限制线（边界情况）？
  - 系统应判定为"临界合规"，并在图表中特别标注这些边界频点

- **What happens when** 用户输入的脉冲参数导致数值计算不稳定（例如 τ 过小）？
  - 系统应给出警告提示，建议合理的参数范围（例如 τ ∈ [0.1ns, 2ns]）

- **What happens when** 频率范围超出图表显示范围（>12 GHz）？
  - 系统应在图表右侧边界标注"频谱在更高频段衰减"，确保读者理解截断的原因

- **How does system handle** FCC 掩蔽罩在不同频段的过渡点（例如 3.1 GHz 从 -53.3 dBm 跃变到 -41.3 dBm）？
  - 系统应绘制准确的阶跃线（垂直线段），避免过渡区域的线性插值导致误解

## Requirements

### Functional Requirements

- **FR-001**: 系统必须能够绘制符合 FCC Part 15.209 标准的室内辐射掩蔽罩曲线，包含所有关键频段的功率限制（0.96-1.61 GHz: -75.3 dBm/MHz, 1.61-3.1 GHz: -53.3 dBm/MHz, 3.1-10.6 GHz: -41.3 dBm/MHz, >10.6 GHz: -51.3 dBm/MHz）

- **FR-002**: 系统必须能够计算并绘制 2 阶和 5 阶高斯导数脉冲的功率谱密度（PSD），频率范围覆盖 0-12 GHz

- **FR-003**: 系统必须支持调整脉冲参数（中心频率 fc、脉冲宽度 τ），并实时重新计算 PSD

- **FR-004**: 系统必须在同一张图表上叠加显示脉冲 PSD 曲线和 FCC 掩蔽罩曲线，使用不同颜色和线型区分

- **FR-005**: 系统必须自动判断脉冲 PSD 是否在所有频点都低于 FCC 限制，并在图表标题或图例中标注合规性状态（"合规"/"不合规"/"临界合规"）

- **FR-006**: 图表必须包含清晰的轴标签（横轴："频率 (GHz)"，纵轴："功率谱密度 (dBm/MHz)"）、图例、网格线，并使用至少 300 DPI 分辨率以满足学术论文出版要求

- **FR-007**: 系统必须在图表中标注关键频率点（例如 3.1 GHz 和 10.6 GHz 的合法频段边界），帮助读者快速识别

- **FR-008**: 系统必须提供保存图表的功能，支持 PNG 格式，文件命名格式为 `psd_fcc_compliance_[order].png`（例如 `psd_fcc_compliance_2nd_5th.png`）

### Key Entities

- **Gaussian Derivative Pulse（高斯导数脉冲）**: 表示 UWB 系统使用的脉冲波形，关键属性包括阶数（n=2, 5）、脉冲宽度 τ（单位：纳秒）、幅度归一化参数。该实体用于生成时域波形并进行傅里叶变换以获得频域特性。

- **Power Spectral Density (PSD)（功率谱密度）**: 表示脉冲在频域的功率分布，关键属性包括频率轴（0-12 GHz）、功率值（单位：dBm/MHz）。该实体通过对脉冲时域信号进行快速傅里叶变换（FFT）计算得出。

- **FCC Indoor Mask（FCC 室内掩蔽罩）**: 表示 FCC Part 15.209 规定的室内 UWB 设备辐射功率限制，关键属性包括多个频段的功率限制值（频率范围和对应的 dBm/MHz 限制）。该实体是法规标准，不依赖于具体脉冲设计。

- **Compliance Result（合规性结果）**: 表示脉冲设计是否满足 FCC 规范，关键属性包括合规状态（"合规"/"不合规"/"临界合规"）、违规频点列表（如果存在）、最大超限量（dB）。该实体通过比较 PSD 和 FCC Mask 的所有频点计算得出。

## Success Criteria

### Measurable Outcomes

- **SC-001**: 生成的 FCC 掩蔽罩曲线准确包含所有 4 个关键频段的功率限制值，每个频段的限制值与 FCC Part 15.209 标准的误差 < 0.1 dB

- **SC-002**: 脉冲 PSD 计算的频率分辨率至少为 10 MHz（即在 0-12 GHz 范围内至少有 1200 个采样点），确保能够精确捕捉频谱细节

- **SC-003**: 合规性判断准确率为 100%——在所有测试用例中，系统判断的合规性状态与手动验证结果完全一致

- **SC-004**: 生成的图表符合 IEEE 论文排版标准，分辨率 ≥300 DPI，坐标轴标签、图例、网格线清晰可读，字体大小适中（10-12 pt）

- **SC-005**: 用户可以在 10 秒内完成从输入脉冲参数到生成最终图表的整个流程（包括 PSD 计算、合规性判断、图表渲染）

- **SC-006**: 图表自动保存到 `outputs/` 目录，文件命名规范清晰，研究人员可以直接在论文中引用，无需二次编辑

- **SC-007**: 5 阶高斯导数脉冲（中心频率优化到 6-7 GHz 范围）在图表中可视化地展示其主要能量集中在 3.1-10.6 GHz 合法频段内，且所有频点低于 FCC 限制线

- **SC-008**: 2 阶高斯导数脉冲在图表中明显展示低频段（<3.1 GHz）存在超出 FCC 限制的部分，帮助论文读者理解为何高阶脉冲更适合 UWB 系统
